<html>
    <head>
        <script
            type="text/javascript"
            src="../../../js/jquery-1.4.2.min.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shCore.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushJScript.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushPhp.js">
        </script>
        <script
            type="text/javascript"
            src="../../../syntax_highlighter/scripts/shBrushXml.js">
        </script>
        <link
            href="../../../syntax_highlighter/styles/shCore.css" rel="stylesheet"
            type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shCoreEclipse.css"
            rel="stylesheet" type="text/css"
        />
        <link
            href="../../../syntax_highlighter/styles/shThemeWordpress.css"
            rel="stylesheet" type="text/css"
        />
    </head>
    <body>
        <pre class="brush: php">&lt;?php
/**
 * User Controller
 * @package \App\Controllers
 */

namespace App\Controllers;
use \App\Models\ModelUser;
use \Core\View;

/**
 * Class User
 * @package App\Controllers
 */
class User extends \Core\Controller {
	
	public static $user;
	
	/**
	 * controller reveals new user registration form.
	 * @return void
	 */
	public function registerFormAction() {
		View::render('User/registerForm.php',
			[
				'title' =&gt; 'Registration',
			], FALSE);
	}
	
	/**
	 * user registration function.
	 * method performs new user check with existing database new user
	 * registration if everything is ok
	 * @return void
	 */
	public function registerAction() {
		if ($_POST['send'] == 'register') {
			foreach ($_POST AS $key =&gt; $value) {
				$_POST[$key] = \Core\Controller::validate($value);
			}
			
			$formData = TRUE;
			$errorMessage = '';
			if (empty($_POST['user'])) {
				$formData = FALSE;
				$errorMessage = &quot;Username is empty!&quot;;
			}
			else {
				if (empty($_POST['pass1']) || empty($_POST['pass2'])) {
					$formData = FALSE;
					$errorMessage = &quot;Password fields cannot be empty!&quot;;
				}
				else {
					if ($_POST['pass1'] !== $_POST['pass2']) {
						$formData = FALSE;
						$errorMessage = &quot;Passwords must be identical&quot;;
					}
					else {
						if (empty($_POST['email'])) {
							$formData = FALSE;
							$errorMessage = &quot;Email field cannot be blank!&quot;;
						}
					}
				}
			}
		}
		else {
			$formData = FALSE;
			$errorMessage = 'Unknown mistake!';
		}
		
		if ($formData === FALSE) {
			View::render('User/registerForm.php',
				[
					'title' =&gt; &quot;Registration&quot;,
					'user' =&gt; $_POST['user'],
					'email' =&gt; $_POST['email'],
					'errorMessage' =&gt; $errorMessage
				], FALSE);
		}
		else {
			if ($formData === TRUE) {
				$data =
					[
						'user' =&gt; $_POST['user'],
						'email' =&gt; $_POST['email'],
						'pass' =&gt; md5($_POST['pass1'])
					];
				$errorMessage = ModelUser::checkUserName($data);
				$errorMessage .= ModelUser::checkUserEmail($data);
				
				if (!empty($errorMessage)) {
					View::render('User/registerForm.php',
						[
							'title' =&gt; &quot;Registration&quot;,
							'user' =&gt; $_POST['user'],
							'email' =&gt; $_POST['email'],
							'errorMessage' =&gt; $errorMessage
						], FALSE);
				}
				else {
					$userAddStatus = ModelUser::userRegistration($data);
					if ($userAddStatus === TRUE) {
						header(&quot;Location: /user/login-form&quot;);
					}
					else {
						View::render('User/registerForm.php',
							[
								'title' =&gt; &quot;Registration&quot;,
								'user' =&gt; $_POST['user'],
								'email' =&gt; $_POST['email'],
								'errorMessage' =&gt; 'User was not registered because of unknown reasons!'
							], FALSE);
					}
				}
			}
		}
	}
	
	/**
	 * Login Form exhibition
	 * @return void
	 */
	public function loginFormAction() {
		View::render('User/loginForm.php',
			[
				'title' =&gt; &quot;login&quot;
			], FALSE);
	}
	
	/**
	 * login function.
	 * function performs user login and creation of object from ModelUser class
	 * that contains current userID and userName
	 * @todo finish wrong authentication procedure
	 * @return void
	 */
	public function loginAction()
	{
		if (isset($_POST['auth']) &amp;&amp; $_POST['auth'] == 'login') {
			foreach ($_POST AS $key =&gt; $value) {
				if ($key == 'pass') {
					$_POST[$key] = md5(\Core\Controller::validate($value));
				} else {
					$_POST[$key] = \Core\Controller::validate($value);
				}
			}
			$result = \App\Models\ModelUser::userLogin($_POST);
			if($result === TRUE){
				self::userCreation();
				View::render('User/successPage.php',
					[
						'title'=&gt;'Success',
						'user'=&gt;$_SESSION['userName']
					]);
			}else{
				/**
				 * require completion
				 */
			}
		}else{
			header(&quot;location: /user/login-form&quot;);
		}
	}
	
	/**
	 * internal function that creates user object from ModelUser class.
	 * contains user id and user name.
	 * @return void;
	 */
	private static function userCreation()
	{
		self::$user = new ModelUser($_SESSION['userID'],$_SESSION['userName']);
	}
}</pre>
        <script type="text/javascript">
             SyntaxHighlighter.all();
             jQuery('.gutter div').each(function(key, data){
                jQuery(data).prepend('<a name="L'+jQuery(data).text()+'"/>');
             });
        </script>
    </body>
</html>